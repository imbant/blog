---
// src/pages/archives/index.astro
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allBlogPosts = await getCollection('blog');
const sortedPosts = allBlogPosts.sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

// Group posts by year
const postsByYear = {};
sortedPosts.forEach(post => {
  const year = new Date(post.data.date).getFullYear();
  if (!postsByYear[year]) {
    postsByYear[year] = [];
  }
  postsByYear[year].push(post);
});

const years = Object.keys(postsByYear).sort((a, b) => b - a);
---

<BaseLayout title="归档 | imbAnt's blog" description="imbAnt's blog 文章归档">
  <main class="container">
    <h1>归档</h1>
    <p>共 {allBlogPosts.length} 篇文章</p>
    
    {years.map(year => (
      <section class="year-section">
        <h2>{year}</h2>
        <ul class="post-list">
          {postsByYear[year].map(post => {
            const date = new Date(post.data.date);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            
            return (
              <li class="post-item">
                <time>{date.toISOString().split('T')[0]}</time>
                <a href={`/blog/${year}/${month}/${day}/${post.slug}/`}>{post.data.title}</a>
              </li>
            );
          })}
        </ul>
      </section>
    ))}
  </main>
</BaseLayout>

<style>
  .container {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem;
  }
  
  .year-section {
    margin-bottom: 3rem;
  }
  
  .year-section h2 {
    margin-bottom: 1rem;
    color: #333;
    border-bottom: 2px solid #eee;
    padding-bottom: 0.5rem;
  }
  
  .post-list {
    list-style: none;
    padding: 0;
  }
  
  .post-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 0.75rem;
    padding: 0.5rem 0;
  }
  
  .post-item time {
    color: #666;
    font-size: 0.9rem;
    min-width: 100px;
  }
  
  .post-item a {
    text-decoration: none;
    color: #333;
    flex: 1;
  }
  
  .post-item a:hover {
    text-decoration: underline;
    color: #0066cc;
  }
</style>