<!DOCTYPE html><html lang="zh-CN"><head><meta name="google-site-verification" content="_s8zp9HC5xK3I7RCh_8RJrSUgYtyNgc09bZvTV11nFI"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="imbant å‰ç«¯å·¥ç¨‹å¸ˆæŠ€æœ¯åšå®¢"><meta name="keywords" content="å‰ç«¯,imbant,æŠ€æœ¯åšå®¢,æµè§ˆå™¨,Electron,React,Vue,Node,Webpack,Vite,Chrome"><title>å…³äº js æ–‡ä»¶ä¸Šä¼  | imbAnt's blog</title><link rel="stylesheet" type="text/css" href="/blog/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any"><link rel="Shortcut Icon" type="image/x-icon" href="/blog/favicon.ico"><link rel="apple-touch-icon" href="/blog/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/blog/apple-touch-icon.png"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZM9NGRYKWS"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-ZM9NGRYKWS');
</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 6.0.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">å…³äº js æ–‡ä»¶ä¸Šä¼ </h1><a id="logo" href="/blog/.">imbAnt's blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/blog/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/blog/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/blog/about/"><i class="fa fa-user"> å…³äº</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container">Hi ğŸ‘‹ï¼Œæ¬¢è¿è®¿é—®æˆ‘çš„åšå®¢
æˆ‘æ˜¯ä¸€åå‰ç«¯å¼€å‘è€…ï¼ŒVS Code æ’ä»¶å’Œè¯­è¨€æœåŠ¡å™¨å¼€å‘è€…
æˆ‘ç›®å‰æ­£åœ¨æ„å»ºåŸºäº LSP çš„ <a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=craftLandstudio.ffugclanguage">è¯­è¨€æœåŠ¡å™¨</a>ï¼Œä¹Ÿåœ¨ç»´æŠ¤ç”¨ Go æ„å»ºçš„ç¼–è¯‘å™¨ã€‚
åœ¨<a href="/about/">è¿™é‡Œ</a>æŸ¥çœ‹æ›´å¤šå…³äºæˆ‘çš„ä¿¡æ¯<br>æˆ‘å¸Œæœ›é€šè¿‡è¿™ä¸ªåšå®¢è®°å½•æŠ€æœ¯çŸ¥è¯†ï¼Œæå‡å½±å“åŠ›ã€‚å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œå¯ä»¥çœ‹çœ‹è¿™äº›æ–‡ç« ï¼š<br><a href="/2024/10/29/VS-Code-Thankyou/">æˆ‘ä¸º VS Code è´¡çŒ®äº†ä»£ç </a><br><a href="2024/08/24/LSP1/">LSP ä¸ VS Code æ’ä»¶å¼€å‘ ç¬¬ä¸€ç« </a><br><a href="2023/03/30/æ€ä¹ˆè®©-favicon-åŠ¨èµ·æ¥/">æ€ä¹ˆè®© favicon åŠ¨èµ·æ¥</a><div class="post"><h1 class="post-title">å…³äº js æ–‡ä»¶ä¸Šä¼ </h1><div class="post-meta">2019-10-10</div><div class="post-content"><h1 id="æœ‰å…³åœ¨-js-ä¸­è¯»å–æ–‡ä»¶"><a href="#æœ‰å…³åœ¨-js-ä¸­è¯»å–æ–‡ä»¶" class="headerlink" title="æœ‰å…³åœ¨ js ä¸­è¯»å–æ–‡ä»¶"></a>æœ‰å…³åœ¨ js ä¸­è¯»å–æ–‡ä»¶</h1><p>æ¢³ç†ä¸€ä¸‹æœ€è¿‘å­¦åˆ°çš„ js è¯»å–æ–‡ä»¶çš„ç›¸å…³çŸ¥è¯†ï¼Œå¦‚æœ‰ç–æ¼ï¼Œè¯·ä¸åèµæ•™ï¼<br>æºç è¯·è§ index.js ä¸ index.html</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/File/Using_files_from_web_applications">MDN-åœ¨ web åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨æ–‡ä»¶</a></li>
<li><a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/1022910821149312/1023022494381696">å»–é›ªå³°-JavaScript æ•™ç¨‹-æ“ä½œæ–‡ä»¶</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/amandakelake/blog/issues/40">JS æ–‡ä»¶ï¼šè¯»å–ä¸æ‹–æ‹½ã€è½¬æ¢ bsae64ã€é¢„è§ˆã€FormData ä¸Šä¼ ã€ä¸ƒç‰›ä¸Šä¼ ã€åˆ†å‰²æ–‡ä»¶</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/34291688">çŸ¥ä¹ä¸“æ -è¸©å‘ç¯‡â€“ä½¿ç”¨ fetch ä¸Šä¼ æ–‡ä»¶</a>ï¼ˆcontent-type ä¸º multipart/form-data æ—¶çš„å‘ï¼‰</li>
</ul>
<h2 id="ç›¸å…³æ¦‚å¿µï¼š"><a href="#ç›¸å…³æ¦‚å¿µï¼š" class="headerlink" title="ç›¸å…³æ¦‚å¿µï¼š"></a>ç›¸å…³æ¦‚å¿µï¼š</h2><ul>
<li>base64 æ ¼å¼</li>
<li>MIME ç±»å‹</li>
<li>HTTP å¤´éƒ¨çš„ Content-Type</li>
<li>FormData æ–¹æ³•</li>
<li>Data URLs</li>
<li>Blob ä¸ File å¯¹è±¡</li>
<li>FileReader å¯¹è±¡</li>
<li>input æ ‡ç­¾ï¼š type=file</li>
</ul>
<h2 id="æµç¨‹æ¦‚è¿°ï¼š"><a href="#æµç¨‹æ¦‚è¿°ï¼š" class="headerlink" title="æµç¨‹æ¦‚è¿°ï¼š"></a>æµç¨‹æ¦‚è¿°ï¼š</h2><p>åŸºæœ¬æµç¨‹ä¼šä¸ç›¸å…³æ¦‚å¿µçš„é¡ºåºç›¸åï¼Œè‡ªé¡¶å‘ä¸‹ä»‹ç»æµç¨‹ã€‚</p>
<h3 id="æœ¬åœ°è·å–æ–‡ä»¶ä¿¡æ¯ï¼š"><a href="#æœ¬åœ°è·å–æ–‡ä»¶ä¿¡æ¯ï¼š" class="headerlink" title="æœ¬åœ°è·å–æ–‡ä»¶ä¿¡æ¯ï¼š"></a>æœ¬åœ°è·å–æ–‡ä»¶ä¿¡æ¯ï¼š</h3><p>é¦–å…ˆï¼ŒHTML é‡Œçš„æ–‡ä»¶è¯»å†™éœ€è¦é€šè¿‡ <code>input</code> æ ‡ç­¾å®ç°ã€‚æˆ‘ä»¬æ–°å»ºä¸€ä¸ªï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;test-file-upload&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ · UI ä¸Šç”¨æˆ·å°±å¯ä»¥ç‚¹å‡»ä¸Šä¼ æŒ‰é’®é€‰æ‹©æ–‡ä»¶äº†ã€‚æˆ‘ä»¬å¯ä»¥è·å–è¿™ä¸ªæ–‡ä»¶çš„æ–‡ä»¶åï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fileInput = <span class="built_in">document</span>.getElementById(<span class="string">&quot;test-file-upload&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(fileInput.value); <span class="comment">// æ–‡ä»¶å</span></span><br></pre></td></tr></table></figure>

<p>HTML5 å¼€å§‹ï¼Œæ–°çš„ File API å…è®¸ js è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè·å¾—æ›´å¤šæ–‡ä»¶ä¿¡æ¯ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  fileInput.addEventListener(<span class="string">&#x27;change&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> file = fileInput.files[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">console</span>.log(file) <span class="comment">// file: File</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¾¹çš„ä»£ç å¯ä»¥æ‹¿åˆ°æ–‡ä»¶å¯¹åº”çš„ <code>File</code> å¯¹è±¡ã€‚è¦æƒ³è¯»å–å…¶ä¸­çš„ä¿¡æ¯ï¼Œéœ€è¦ç”¨åˆ° <code>FileReader</code> å¯¹è±¡:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">fileInput.addEventListener(<span class="string">&quot;change&quot;</span>, <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> file = fileInput.files[<span class="number">0</span>];</span><br><span class="line">  <span class="built_in">console</span>.log(file); <span class="comment">// file: File</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">let</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// reader è¯»å– File å¯¹è±¡æ˜¯ä¸€ç§è¯·æ±‚ã€‚å½“è¯»å–å®Œæˆï¼Œä¼šè§¦å‘ load äº‹ä»¶ï¼Œ</span></span><br><span class="line">  <span class="comment">// å¹¶æŠŠ reader.result è®¾å®šä¸ºè¯»å–åˆ°çš„å€¼</span></span><br><span class="line">  reader.addEventListener(<span class="string">&quot;load&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(reader.result);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è§„å®šä¸€ä¸ªè¯»å– File å¯¹è±¡çš„æ–¹æ³•å¹¶æ‰§è¡Œï¼Œè¿™é‡Œå°†å…¶è§£æä¸º DataURL</span></span><br><span class="line">  reader.readAsDataURL(file);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±æŠŠ <code>File</code> å¯¹è±¡è§£ææˆ <code>DataURL</code> æ ¼å¼çš„<strong>å­—ç¬¦ä¸²</strong>äº†ã€‚ç”±äºæ–‡ä»¶æ˜¯å›¾ç‰‡ï¼Œè‡ªåŠ¨å°†å…¶è½¬ç ä¸º base64 æ ¼å¼ã€‚<code>DataURL</code> åŸºæœ¬çš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAADâ€¦<br>ï¼ˆåè¾¹å…¨æ˜¯ bse64 ç¼–ç ï¼‰</p>
</blockquote>
<p>æœ‰äº† <code>DataURL</code>ï¼Œå°±å¯ä»¥å®ç°ä¸Šä¼ æ–‡ä»¶ä¹‹åçš„é¢„è§ˆåŠŸèƒ½ï¼šè¿™ä¸ªå­—ç¬¦ä¸²æ˜¯å¯ä»¥å†™å…¥ <code>img</code> æ ‡ç­¾çš„ src è¢«è§£æçš„ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;preview-img&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">img</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> previewImg = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;preview-img&#x27;</span>);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">reader.addEventListener(<span class="string">&quot;load&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(reader.result);</span><br><span class="line">  previewImg.src = reader.result;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>æ ¹æ® <code>DataURL</code> çš„å®šä¹‰ï¼Œåœ¨ <code>&#39;base64,&#39;</code> åè¾¹çš„å­—ç¬¦ä¸²å°±æ˜¯å›¾ç‰‡çš„ç¼–ç äº†ã€‚å°†å®ƒä»¬å‘é€ç»™æœåŠ¡å™¨ï¼Œå†ç”¨ base64 è§£ç å³å¯å¾—åˆ°åŸå§‹æ–‡ä»¶çš„äºŒè¿›åˆ¶å†…å®¹ã€‚<br>å…·ä½“åˆ°ä»£ç ï¼Œå°±æ˜¯åœ¨è¯»å–å®Œæ¯•æ–‡ä»¶ï¼ˆloadï¼‰åï¼Œå°±å¯ä»¥å‘é€ç»“æœäº†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reader è¯»å– File å¯¹è±¡æ˜¯ä¸€ç§è¯·æ±‚ã€‚å½“è¯»å–å®Œæˆï¼Œä¼šè§¦å‘ load äº‹ä»¶ï¼Œå¹¶æŠŠ reader.result è®¾å®šä¸ºè¯»å–åˆ°çš„å€¼</span></span><br><span class="line">reader.addEventListener(<span class="string">&quot;load&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(reader.result);</span><br><span class="line">  previewImg.src = reader.result;</span><br><span class="line"></span><br><span class="line">  fetch(<span class="string">&quot;example.com&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">body</span>: reader.result, <span class="comment">// <span class="doctag">TODO:</span> è¿™é‡Œè¿˜æ˜¯ DataURLï¼Œéœ€è¦è§†æ¥å£è¿›è¡Œæ ¼å¼è½¬æ¢</span></span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span></span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;æˆåŠŸå‘é€è¯·æ±‚:&quot;</span>, data))</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.error(err));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šå°±æ˜¯åŸºæœ¬çš„æœ¬åœ°è·å–ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶å†…å®¹çš„ç›¸å…³ä»£ç äº†ã€‚</p>
<p>ä¸‹ä¸€æ­¥ï¼Œè€ƒè™‘å¦‚ä½•å°† Base64 è½¬ç ï¼Œå¹¶å‘æœåŠ¡å™¨æ­£ç¡®å‘é€è¯·æ±‚ã€‚</p>
<h3 id="å‘æœåŠ¡å™¨å‘é€è¯·æ±‚"><a href="#å‘æœåŠ¡å™¨å‘é€è¯·æ±‚" class="headerlink" title="å‘æœåŠ¡å™¨å‘é€è¯·æ±‚"></a>å‘æœåŠ¡å™¨å‘é€è¯·æ±‚</h3><p>å‡è®¾åç«¯æ¥å£å¦‚ä¸‹ï¼š</p>
<h4 id="Headers"><a href="#Headers" class="headerlink" title="Headers:"></a>Headers:</h4><table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th>å‚æ•°å€¼</th>
</tr>
</thead>
<tbody><tr>
<td>Content-Type</td>
<td>multipart/form-data</td>
</tr>
</tbody></table>
<h3 id="Body"><a href="#Body" class="headerlink" title="Body:"></a>Body:</h3><table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th>å‚æ•°ç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td>file</td>
<td>æ–‡ä»¶</td>
</tr>
</tbody></table>
<p>å…ˆè§£é‡Šä¸€ä¸‹ <code>multipart/form-data</code> è¿™ä¸ª <code>Content-Type</code>ï¼š<br>åœ¨åŸç”Ÿ HTML - js ä½“ç³»ä¸­ï¼Œä¸Šä¼ æ–‡ä»¶æ˜¯åœ¨ <code>form</code> æ ‡ç­¾ä¸­å®ç°çš„ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;file&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“ä¸€ä¸ªè¡¨å•åŒ…å«<code>&lt;input type=&quot;file&quot;&gt;</code>æ—¶ï¼Œè¡¨å•çš„ <code>enctype</code> å¿…é¡»æŒ‡å®šä¸º <code>multipart/form-data</code>ï¼Œ<code>method</code> å¿…é¡»æŒ‡å®šä¸º <code>post</code>ï¼Œæµè§ˆå™¨æ‰èƒ½æ­£ç¡®ç¼–ç å¹¶ä»¥ <code>multipart/form-data</code> æ ¼å¼å‘é€è¡¨å•çš„æ•°æ®ã€‚</p>
<p>åœ¨ç°ä»£å‰ç«¯æ¡†æ¶ä¸­ï¼Œä¸ºäº†å®ç°æ–‡ä»¶ä¸Šä¼ ï¼Œå¿…é¡»æ¨¡æ‹Ÿè¿™ä¸ªæ•ˆæœï¼Œå› æ­¤å¼•å…¥ <code>FormData</code> å¯¹è±¡ã€‚<br><code>FormData</code> æ¥å£æä¾›äº†ä¸€ç§è¡¨ç¤ºè¡¨å•æ•°æ®çš„é”®å€¼å¯¹çš„æ„é€ æ–¹å¼,æ¨¡æ‹Ÿä¸€ä»½è¦å‘ç»™æœåŠ¡å™¨çš„è¡¨å•ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">fileInput.addEventListener(<span class="string">&#x27;change&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  reader.readAsDataURL(file);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">  <span class="comment">// ä¸º formData å¯¹è±¡æ·»åŠ ä¸€ä¸ª key-value å¯¹ã€‚</span></span><br><span class="line">  <span class="comment">// &#x27;file&#x27; ä¸ºè¡¨å•åç§°ï¼Œä¸æ¥å£ä¸­ Body çš„å‚æ•° file å¯¹åº”</span></span><br><span class="line">  <span class="comment">// æ³¨æ„ append ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå¯å‚è€ƒ mdn æ–‡æ¡£ã€‚</span></span><br><span class="line">  formData.append(<span class="string">&#x27;file&#x27;</span>, file);</span><br><span class="line">  fetch(<span class="string">&#x27;https://example.com&#x27;</span>, &#123;</span><br><span class="line">    <span class="comment">// æ³¨æ„è¿™é‡Œä¸ç”¨å†™ content-tpyeï¼ŒåŸå› è§ä¸‹æ–‡</span></span><br><span class="line">    <span class="comment">// headers:&#123;&#x27;Content-Type&#x27;: &#x27;multipart/form-data&#x27;&#125;,</span></span><br><span class="line">    <span class="attr">body</span>: formData,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;æˆåŠŸå‘é€è¯·æ±‚:&#x27;</span>, data))</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.error(err));</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸€ä¸ªå‘ï¼š<code>fetch</code> æ–¹æ³•é‡Œæ²¡æœ‰é…ç½® <code>content-type</code>ï¼Œè¿™é‡Œçš„åŸå› æ˜¯ï¼š<code>FormData()</code> æ¨¡æ‹Ÿäº†ä¸€ä»½æ•°æ®è¡¨å•ï¼Œä¼šè‡ªåŠ¨è®¾ç½® <code>content-type</code>ï¼Œäº‹å®ä¸Šï¼Œè‡ªåŠ¨è®¾ç½®çš„ <code>content-type</code> é‡Œä¸åªæœ‰ <code>multipart/form-data</code> è¿™ä¸ªå€¼ï¼Œè¿˜è®¾ç½®äº†ä¸€ä¸ª <code>Boundary</code>ã€‚æ‰¾äº†ä¸€å¼ çŸ¥ä¹<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/34291688">æŸ³å…®</a>å°å§å§çš„æˆªå›¾ï¼š<br><img src="https://imbant-blog.oss-cn-shanghai.aliyuncs.com/blog-img/3/%E5%85%B3%E4%BA%8E-js-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A01.jpg" alt="img"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒHeaders ä¸­å·²ç»æœ‰ä¸€ä¸ª <code>content-type</code> äº†ï¼ˆç¬¬ä¸€è¡Œï¼‰ã€‚<code>multipart/form-data</code> åè¾¹å¤šäº†ä¸€ä¸ª <code>Boundary</code>ã€‚è¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªæ ‡ç¤ºåˆ†ç•Œçº¿çš„ä½œç”¨ï¼Œå¯ä»¥çœ‹åˆ° <code>Request Payload</code> æºç é‡Œæœ‰å‡ ä¸ªç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œè¿™äº›çš„ä½œç”¨å°±å’Œå†™æ–‡ç« çš„åˆ†å‰²çº¿ä¸€æ ·ï¼ŒæŠŠ Body åˆ†æˆå¥½å‡ ä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†å¯¹åº”ä¸€ä¸ª <code>form</code> è¡¨å•çš„å­—æ®µã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ¯ä¸ªéƒ¨åˆ†ä¸­éƒ½æœ‰æ–°å®šä¹‰çš„ <code>content-disposition</code> å’Œ <code>content-type</code> è¿™äº›ã€Œæœ¬è¯¥ã€å‡ºç°åœ¨ Headers é‡Œçš„å­—æ®µï¼Œè¿™äº›éƒ½æ˜¯æœåŠ¡å™¨ç”¨äºåˆ†æ®µè§£æ Body çš„ã€‚</p>
<p>å†å›å¤´çœ‹ <code>fetch</code>ï¼Œå¦‚æœåœ¨é‡Œè¾¹æ‰‹åŠ¨å†™ä¸Š <code>content-type</code>ï¼Œå°±ä¼šç”¨ç©ºç™½è¦†ç›–æ‰è‡ªåŠ¨è®¾ç½®çš„ <code>Boundary</code>ï¼ŒæœåŠ¡å™¨æ˜¯è¦æŠ›å‡º 500 å¹¶æŠ¥é”™çš„ï¼š</p>
<blockquote>
<p>Error: Multipart: Boundary not found</p>
</blockquote>
<h4 id="æœ‰å‡ å¥åè¯ï¼š"><a href="#æœ‰å‡ å¥åè¯ï¼š" class="headerlink" title="æœ‰å‡ å¥åè¯ï¼š"></a>æœ‰å‡ å¥åè¯ï¼š</h4><p>ç”±äºåç«¯æ¥å£æ¥å—ä¸€ä¸ª File å¯¹è±¡ï¼Œå‰è¾¹ç”¨ FileReader å°† File è½¬ä¸º DataURL ä¼¼ä¹æ²¡å•¥åµç”¨ï¼ˆé™¤äº†èƒ½é¢„è§ˆæ–‡ä»¶ï¼‰ï¼Œä½†å´å¹¶æ²¡æœ‰ç”¨åˆ°å½“æ—¶å†™å¥½çš„ fetch è¯·æ±‚ã€‚äº‹å®ä¸Šï¼Œå‰è¾¹è½¬ç è¿˜æ˜¯æœ‰æ„ä¹‰çš„ï¼šè¯»å–åˆ°ä»£è¡¨æ–‡ä»¶å†…å®¹çš„ä¿¡æ¯ï¼Œå°±å¯ä»¥åšä¸€äº›ç›¸å…³æ“ä½œï¼Œä¾‹å¦‚ç»™ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡åŠ ä¸Šæ°´å°åï¼Œæ‰å‘é€ç»™åç«¯å‚¨å­˜ã€‚è¿™ç§éœ€æ±‚å°±éœ€è¦å¯¹ DataURL åšæ“ä½œï¼ˆå€ŸåŠ© canvas ç­‰ï¼‰ï¼Œä»¥å¾—åˆ°ä¸€ä»½åŠ äº†æ°´å°çš„æ–‡ä»¶ã€‚å½“ç„¶ï¼Œå¦‚æœåç«¯æ¥å£ä»ç„¶æ˜¯æ¥æ”¶ä¸€ä¸ª File å¯¹è±¡ï¼Œåˆ™éœ€è¦å°†åŠ å¥½æ°´å°çš„ DataURL å†è½¬æ¢ä¸º File å¯¹è±¡ï¼Œç„¶åå‘é€ä¸Šä¼ å›¾ç‰‡è¯·æ±‚ã€‚<br>åœ¨å°† DataURL è½¬æ¢ä¸º File å¯¹è±¡æ—¶ä¹Ÿæœ‰ä¸ªå‘ï¼š<br>å¯ä»¥ä½¿ç”¨ fetch è®¿é—® DataURLï¼ˆä»è¯­ä¹‰ä¸Šï¼Œè¿™å°±æ˜¯ URL çš„åŠŸèƒ½äº†ï¼šå¯ä»¥ç›´æ¥å†™åœ¨ img çš„ src é‡Œï¼Œä¹Ÿå¯ä»¥è¢« fetchï¼‰ã€‚ä½†è¿™ç§åšæ³•ä¼šæœ‰äº›æ•°æ®æŸå¤±ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">reader.addEventListener(<span class="string">&#x27;load&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  fetch(reader.result <span class="keyword">as</span> string)</span><br><span class="line">    .then(<span class="function"><span class="params">res</span> =&gt;</span> res.blob())</span><br><span class="line">    .then(<span class="function"><span class="params">blob</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œ fetch åˆ°çš„ç»“æœæ˜¯ Blob å¯¹è±¡ï¼Œè€Œä¸æ˜¯ File å¯¹è±¡</span></span><br><span class="line">    <span class="comment">// ä¸¤è€…å¾ˆç›¸ä¼¼ï¼ŒFile æ¯” Blob å¤šä¸¤ä¸ªå­—æ®µï¼šname å’Œ lastModifiedDate</span></span><br><span class="line">    <span class="comment">// ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ File -&gt; DataURL -&gt; Blob çš„è¿‡ç¨‹ä¸­ï¼Œæ–‡ä»¶æ•°æ®æœ‰ä¸¤ä¸ªå­—æ®µçš„æŸå¤±</span></span><br><span class="line">    &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/blog/tags/JS/"><i class="fa fa-tag"></i>JS</a></div><div class="post-nav"><a class="pre" href="/blog/2019/11/19/flex-box-%E4%B8%8B%E7%9A%84%E5%AE%BD%E5%BA%A6%E9%97%AE%E9%A2%98/">flex box ä¸‹çš„å®½åº¦é—®é¢˜</a><a class="next" href="/blog/2019/09/11/Token-Session-Cookie/">Token Session Cookie</a></div><div class="giscus"></div><script src="https://giscus.app/client.js" data-repo="imbant/blog" data-repo-id="MDEwOlJlcG9zaXRvcnkyNDkzOTc0NDM=" data-category="General" data-category-id="DIC_kwDODt2Aw84Ch79K" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async></script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://imbant.github.io/blog"/></form></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer"><span id="footer-copyright">Copyright Â© </span><a href="/blog/." rel="nofollow">imbAnt's blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a><script>const tag = document.getElementById('footer-copyright');const year = new Date().getFullYear();tag.innerText += year + ' ';</script></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/blog/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/blog/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/blog/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/blog/js/smartresize.js?v=1.0.0"></script><script type="text/javascript" src="/blog/js/gifFavIcon.js"></script></div></body></html>